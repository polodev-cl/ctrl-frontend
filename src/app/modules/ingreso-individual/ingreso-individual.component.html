<app-navbar></app-navbar>
<app-modal-resumen-ingreso-individual
  *ngIf="mostrarModalResumenIngresoIndividual"
  [datosModal]="datosParaModal"
  (cerrar)="cerrarModalResumenIngresoIndividual()"
  (exito)="abrirModalExito()"
></app-modal-resumen-ingreso-individual>
<app-modal-exitoso
  (cerrar)="cerrarModalExito()"
  *ngIf="mostrarModalExito"
  [mensajeModal]="mensajeModalExito"
  [titulo]="tituloModalExito"
>
</app-modal-exitoso>

<div class="container-md">
  <div class="frame mt-3" id="frame_middletop">
    <div class="row">
      <div class="col-md-12">
        <h2 class="consultation-title">
          <img
            class=""
            height="16"
            src="../../../assets/image/logo-amarillo.jpg"
          />
          Ingreso Individual
        </h2>
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            @for (crumb of breadcrumbs; track crumb.text) {
            <li class="breadcrumb-item" [class.active]="$last">
              <a *ngIf="!$last" [routerLink]="crumb.link">{{ crumb.text }}</a>
              <span *ngIf="$last">{{ crumb.text }}</span>
            </li>
            }
          </ol>
        </nav>
      </div>
    </div>
  </div>

  <form [formGroup]="ingresoIndividualForm" class="mt-4">
    <div class="grid-container gap-3">
      <div class="grid-item my-3">
        <div class="card flex flex-wrap gap-3 p-fluid border-0">
          <div class="flex-auto">
            <span class="p-float-label">
              <p-calendar
                [iconDisplay]="'input'"
                [showIcon]="true"
                dateFormat="dd/mm/yy"
                id="fecha_ingreso"
                inputId="fecha_ingreso"
                formControlName="fechaIngreso"
              ></p-calendar>
              <label class="" for="fecha_ingreso">Fecha de ingreso</label>
            </span>
          </div>
        </div>
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            autocomplete="on"
            class="w-100 rounded"
            id="rut"
            pInputText
            #rut
            type="text"
            [value]="rut.value | rutPipe"
            formControlName="rut"
          />
          <label for="rut">Rut (12345678-9)</label>
        </span>
      </div>
      <div class="grid-item my-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Empresa</mat-label>
          <mat-select (selectionChange)="onEmpresaChange($event.value)">
            @for (empresa of selectorEmpresas; track empresa.value) {
            <mat-option [value]="empresa.value">{{ empresa.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      <div class="grid-item my-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Agencia</mat-label>
          <mat-select
            (selectionChange)="onAgencyChange()"
            formControlName="agenciaId"
          >
            @for (agency of selectorAgencies; track agency.id) {
            <mat-option [value]="agency.id">{{ agency.nombre }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            class="w-100 rounded"
            id="dpc"
            pInputText
            placeholder="DPC"
            type="text"
            formControlName="agenciaDpc"
          />
          <label for="dpc">DPC</label>
        </span>
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            class="w-100 rounded"
            id="nemonico"
            pInputText
            placeholder="Nemónico"
            type="text"
            formControlName="agenciaMnemonic"
          />
          <label for="nemonico">Nemónico</label>
        </span>
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            class="w-100 rounded"
            formControlName="inventario"
            id="inventario"
            pInputText
            type="Number"
          />
          <label for="inventario">N° Inventario</label>
        </span>
      </div>
      <div class="grid-item my-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Tipo de Equipo</mat-label>
          <mat-select
            (selectionChange)="onTypeChange($event.value)"
            formControlName="tipo"
          >
            @for (type of equipmentTypes; track type.value) {
            <mat-option [value]="type.value">{{ type.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <div class="grid-item my-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Sistema Operativo</mat-label>
          <mat-select
            (selectionChange)="onSOChange($event.value)"
            formControlName="sistemaOperativo"
          >
            @for (so of selectorSistemasOperativos; track so.so) {
            <mat-option [value]="so.so">{{ so.so }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>

      <div class="grid-item my-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Modelo</mat-label>
          <mat-select formControlName="sistemaOperativoVersion">
            @for (version of selectorVersionesFiltradas; track version) {
            <mat-option [value]="version">{{ version }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      <div class="grid-item my-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Uso</mat-label>
          <mat-select formControlName="uso">
            <mat-option value="Administrativo">Administrativo</mat-option>
            <mat-option value="Caja">Caja</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            autocomplete="on"
            class="w-100 rounded"
            id="marca"
            pInputText
            type="text"
            formControlName="marca"
          />
          <label for="marca">Marca</label>
        </span>
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            autocomplete="on"
            class="w-100 rounded"
            id="modelo"
            pInputText
            type="text"
            formControlName="modelo"
          />
          <label for="modelo">Modelo</label>
        </span>
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            class="w-100 rounded"
            formControlName="mac"
            id="mac"
            pInputText
            type="text"
          />
          <label for="mac">MAC (XX:XX:XX:XX:XX:XX)</label>
        </span>
        <!--        <div *ngIf="isValidMAC === false" class="text-danger">-->
        <!--          Dirección MAC no válida-->
        <!--        </div>-->
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            (keyup)="limitAndValidateIP()"
            class="w-100 rounded"
            formControlName="ip"
            id="ip"
            pInputText
            type="text"
          />

          <label for="ip">IP (IPV4 o IPv6)</label>
        </span>
        <!--        <div *ngIf="isValidIP === false" class="text-danger"> &lt;!&ndash; TODO: implementar mat-error &ndash;&gt;-->
        <!--          Dirección IP no válida-->
        <!--        </div>-->
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            class="w-100 rounded"
            formControlName="nombre"
            id="maquina"
            pInputText
            type="text"
          />
          <label for="maquina">Nombre Máquina </label>
        </span>
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            class="w-100 rounded"
            formControlName="procesador"
            id="procesador"
            pInputText
            type="text"
          />
          <label for="procesador">Procesador</label>
        </span>
      </div>
      <div class="grid-item my-3">
        <div class="p-float-label position-relative">
          <input
            class="w-100 rounded"
            formControlName="ramGb"
            id="ram"
            pInputText
            type="text"
          />
          <label for="ram">RAM</label>
          <div
            *ngIf="!isEquipmentWithNoOptions(selectedType)"
            class="position-absolute"
            style="
              top: 0;
              right: 10px;
              height: 100%;
              display: flex;
              align-items: center;
              pointer-events: none;
            "
          >
            GB
          </div>
        </div>
      </div>

      <div class="grid-item my-3">
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Disco</mat-label>
          <mat-select formControlName="disco">
            <mat-option value="SSD">SSD</mat-option>
            <mat-option value="HDD">HDD</mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="grid-item my-3">
        <!-- TODO: revisar appLimitInput, a que corresponde -->
        <span class="p-float-label">
          <!-- TODO: usar valueChanges -->
          <input
            appLimitInput
            class="w-100 rounded"
            formControlName="ddllTbk"
            id="ddlTbk"
            pInputText
            type="text"
          />
          <label for="ddlTbk">DDL/TBK (XXX-XXX-XXX)</label>
        </span>
        <!--        <div *ngIf="isValidDDLTBK === false" class="text-danger">-->
        <!--          Formato DDL/TBK no válido-->
        <!--        </div>-->
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            class="w-100 rounded"
            formControlName="serie"
            id="serie"
            pInputText
            type="text"
          />
          <label for="serie">Número de Serie </label>
        </span>
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            autocomplete="on"
            class="w-100 rounded"
            id="encargado"
            pInputText
            type="text"
            formControlName="encargadoAgencia"
          />
          <label for="encargado">Encargado Agencia *</label>
        </span>
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            class="w-100 rounded"
            formControlName="ubicacion"
            id="ubicacion"
            pInputText
            type="text"
          />
          <label for="ubicacion">Ubicación *</label>
        </span>
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            class="w-100 rounded"
            id="garantia"
            pInputText
            type="Number"
            formControlName="garantiaMeses"
          />
          <label for="garantia">Garantía *</label>
        </span>
      </div>
      <div class="grid-item my-3">
        <span class="p-float-label">
          <input
            autocomplete="on"
            class="w-100 rounded"
            id="orden_compra"
            formControlName="ordenCompra"
            pInputText
            type="text"
          />
          <label for="orden_compra">Orden de compra</label>
        </span>
      </div>
    </div>
  </form>

  <div class="row">
    <div class="col">
      <hr />
    </div>
  </div>

  <div class="row mt-3 mb-5">
    <div class="col-12">
      <div class="d-flex justify-content-between">
        <button
          class="back-button rounded-xl px-5 py-2"
          label="Volver"
          pButton
          routerLink="/home"
          type="button"
        ></button>

        <button
          (click)="onSubmit()"
          class="search-button px-5 py-2"
          label="Ingresar"
          [disabled]="!ingresoIndividualForm.valid"
          pButton
          type="button"
        ></button>
      </div>
    </div>
  </div>
</div>
