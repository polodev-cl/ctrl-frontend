<app-navbar></app-navbar>
<app-modal-historial-equipo
  [equipoId]="equipoActualId"
  (cerrar)="cerrarModalHistorialEquipo()"
  *ngIf="mostrarModalHistorialEquipo"
>
</app-modal-historial-equipo>

<div class="container-md">
  <div class="frame mt-3" id="frame_middletop">
    <div class="row">
      <div class="col-md-6">
        <h2 class="consultation-title">
          <img
            class=""
            height="16"
            src="../../../assets/image/logo-amarillo.jpg"
          />
          Consulta Individual
        </h2>

        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li
              *ngFor="let crumb of breadcrumbs; let last = last"
              [class.active]="last"
              class="breadcrumb-item"
            >
              <a *ngIf="!last" [routerLink]="crumb.link">{{ crumb.text }}</a>
              <span *ngIf="last">{{ crumb.text }}</span>
            </li>
          </ol>
        </nav>
      </div>

      <!-- <div class="col-md-6 col-sm-12">
        <div class="profile-details text-md-end">
          <p class="mb-0">Juan Perez</p>
          <p class="mb-0">10.923.948-8</p>
          <p class="mb-0">Empresa: Starken</p>
        </div>
      </div> -->
    </div>

    <div class="row mt-4 mb-3">
      <div
        *ngFor="let equipment of equipments; let i = index"
        class="col-md-6 mb-4"
      >
        <div class="card border rounded card-shadow-box-datas">
          <div class="card-body">
            <div class="row">
              <div class="col">
                <h5 class="card-title">Datos del equipo #{{ i + 1 }}</h5>
              </div>
              <div class="col-auto">
                <span class="badge bg-secondary tiempo-garantia">
                  Tiempo de garantía:
                  {{
                    calcularMesesGarantiaRestantes(equipment.fechaCompra, equipment.garantiaMeses) > 1 ?
                    (calcularMesesGarantiaRestantes(equipment.fechaCompra, equipment.garantiaMeses) + ' Meses') :
                    (calcularMesesGarantiaRestantes(equipment.fechaCompra, equipment.garantiaMeses) === 1 ? '1 Mes' :
                    'Se ha acabado la garantía')
                  }}
                </span>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col">
                <p><strong>Equipo:</strong> {{ equipment.tipo }}</p>
                <p><strong>Marca:</strong> {{ equipment.marca }}</p>
                <p><strong>Modelo:</strong> {{ equipment.modelo }}</p>
                <p><strong>Uso:</strong> {{ equipment.uso }}</p>
                <p><strong>Ubicación:</strong> {{ equipment.ubicacion }}</p>
              </div>
              <div class="col">
                <p><strong>Número CI:</strong> {{ equipment.inventario }}</p>
                <p><strong>Agencia:</strong> {{ equipment.agencia?.nombre || "agencia eliminada" }}</p>
                <p><strong>DPC:</strong> {{ equipment.agenciaDpc }}</p>
                <p>
                  <strong>Nemónico:</strong> {{ equipment.agenciaMnemonic || "N/A" }}
                </p>
                <p>
                  <strong>Estado:</strong>
                  {{ equipment.estado === 1 ? "Activo" : "Inactivo" }}
                </p>
              </div>
              <div class="col">
                <p><strong>Rut:</strong> {{ equipment.rut }}</p>
                <p><strong>N° Serie:</strong> {{ equipment.serie }}</p>
                <p><strong>Encargado Agencia:</strong> {{ equipment.encargadoAgencia }}</p>
                <p><strong>Fecha Ingreso:</strong> {{ equipment.fechaIngreso }}</p>
              </div>
            </div>
            <div class="row mt-3 d-flex justify-content-between">
              <div class="col-12 col-md-5 mb-3 pe-md-0">
                <button
                (click)="abrirModalHistorialEquipo(equipment.id)"
                  class="historial-button p-2 w-100"
                  label="Ver Historial"
                  pButton
                  type="button"
                ></button>
              </div>
              <div class="col-12 col-md-5  mb-3 ps-md-0 " *ngIf="rol === RoleEnum.ADMIN">
                <button
                  class="equipo-button p-2 w-100 rounded-5"
                  label="Ver Equipo"
                  pButton
                  type="button"
                  [routerLink]="['/editar-equipamiento', equipment.id]"
                ></button>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
